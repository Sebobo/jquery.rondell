/*!
jQuery rondell plugin
@name jquery.rondell.js
@author Sebastian Helzle (sebastian@helzle.net or @sebobo)
@version 1.1.0
@date 2013-10-27
@category jQuery plugin
@copyright (c) 2009-2013 Sebastian Helzle (www.sebastianhelzle.net)
@license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
var __bind=function(a,b){return function(){return a.apply(b,arguments)}};!function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb;return e=a(b),d=a(c),_="rondell",m=""+_+"-instance",j=""+_+"-container",l=""+_+"-initializing",Q=""+_+"-theme",i=""+_+"-caption",k=""+_+"-control",O=""+_+"-shift-left",P=""+_+"-shift-right",G=""+_+"-no-scale",n=""+_+"-item",t=""+n+"-image",w=""+n+"-resizeable",x=""+n+"-small",r=""+n+"-hidden",u=""+n+"-loading",s=""+n+"-hovered",v=""+n+"-overlay",q=""+n+"-focused",o=""+n+"-crop",p=""+n+"-error",y=""+_+"-lightbox",D=""+y+"-overlay",A=""+y+"-content",B=""+y+"-inner",z=""+y+"-close",F=""+y+"-prev",E=""+y+"-position",C=""+y+"-next",H=""+_+"-scrollbar",J=""+H+"-control",K=""+H+"-dragging",I=""+H+"-background",M=""+H+"-left",N=""+H+"-right",L=""+H+"-inner",T="click."+_,V="resize."+_,U="mousewheel."+_,a.rondell||(a.rondell={version:"1.1.0",name:"rondell",lightbox:{instance:void 0,template:a.trim("        <div class='"+y+"'>          <div class='"+D+"'>&nbsp;</div>          <div class='"+A+"'>            <div class='"+B+"'/>            <div class='"+z+"'>&Chi;</div>            <div class='"+F+"'>&nbsp;</div>            <div class='"+E+"'>1</div>            <div class='"+C+"'>&nbsp;</div>          </div>        </div>")},defaults:{showContainer:!0,currentLayer:0,radius:{x:250,y:50},center:{left:340,top:160},size:{width:null,height:null},visibleItems:"auto",scaling:2,opacityMin:.05,fadeTime:300,keyDelay:300,zIndex:1e3,itemProperties:{delay:100,size:{width:150,height:150},sizeFocused:{width:0,height:0}},lightbox:{enabled:!0,displayReferencedImages:!0},imageFiletypes:["png","jpg","jpeg","gif","bmp"],repeating:!0,wrapIndices:!0,switchIndices:!1,alwaysShowCaption:!1,captionsEnabled:!0,autoRotation:{enabled:!1,paused:!1,direction:0,once:!1,delay:5e3},controls:{enabled:!0,fadeTime:400,margin:{x:130,y:270}},strings:{prev:"prev",next:"next",loadingError:"An error occured while loading <b>%s</b>",more:"More..."},mousewheel:{enabled:!0,threshold:0,minTimeBetweenShifts:500},touch:{enabled:!0,preventDefaults:!0,threshold:100},randomStart:!1,funcEase:"easeInOutQuad",theme:"default",preset:"",effect:null,onAfterShift:null,onUpdateLightbox:null,cropThumbnails:!1,scrollbar:{enabled:!1,orientation:"bottom",start:1,end:100,stepSize:1,keepStepOrder:!0,position:1,padding:10,style:{width:"100%",height:20,left:"auto",right:"auto",top:"auto",bottom:"auto"},repeating:!1,onScroll:void 0,scrollOnHover:!1,scrollOnDrag:!0}}}),(bb=a.easing).easeInOutQuad||(bb.easeInOutQuad=function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c}),S=function(a,b){return setTimeout(b,a)},f=function(){function b(c,d,e){var f,g,i,k,n,o;this.container=c,this.initCallback=null!=e?e:void 0,this.showLightbox=__bind(this.showLightbox,this),this.keyDown=__bind(this.keyDown,this),this.isFocused=__bind(this.isFocused,this),this.onWindowBlur=__bind(this.onWindowBlur,this),this.onWindowFocus=__bind(this.onWindowFocus,this),this._autoShift=__bind(this._autoShift,this),this._autoShiftInit=__bind(this._autoShiftInit,this),this.shiftRight=__bind(this.shiftRight,this),this.shiftLeft=__bind(this.shiftLeft,this),this._refreshControls=__bind(this._refreshControls,this),this.getIndexInRange=__bind(this.getIndexInRange,this),this.getRelativeItemPosition=__bind(this.getRelativeItemPosition,this),this.shiftTo=__bind(this.shiftTo,this),this._hover=__bind(this._hover,this),this._onTouch=__bind(this._onTouch,this),this._onMousewheel=__bind(this._onMousewheel,this),this.bindEvents=__bind(this.bindEvents,this),this._start=__bind(this._start,this),this.onItemInit=__bind(this.onItemInit,this),this._loadItem=__bind(this._loadItem,this),this._getItem=__bind(this._getItem,this),this._onMouseLeaveItem=__bind(this._onMouseLeaveItem,this),this._onMouseEnterItem=__bind(this._onMouseEnterItem,this),this.fitToContainer=__bind(this.fitToContainer,this),this.clear=__bind(this.clear,this),this.update=__bind(this.update,this),this.id=++b.rondellCount,this.items=[],f=c.children(),this.maxItems=f.length,1===this.id&&(b.activeRondell=this.id),i=(null!=d?d.preset:void 0)in a.rondell.presets?a.rondell.presets[d.preset]:{},a.extend(!0,this,a.rondell.defaults,i,d||{}),a.extend(!0,this,{_dimensions:{computed:!1},_lastKeyEvent:0,_windowFocused:!0,_focusedIndex:this.currentLayer,_itemIndices:{0:0},autoRotation:{_timer:-1},controls:{_lastShift:0},touch:{_start:void 0,_end:void 0},scrollbar:{_instance:null}}),this.itemProperties.sizeFocused={width:this.itemProperties.sizeFocused.width||this.itemProperties.size.width*this.scaling,height:this.itemProperties.sizeFocused.height||this.itemProperties.size.height*this.scaling},this.size={width:this.size.width||2*this.center.left,height:this.size.height||2*this.center.top},this.container.data(_,this).css(this.size).addClass(""+l+" "+j+" "+Q+"-"+this.theme+" "+m+"-"+this.id),this.scrollbar.enabled&&(k=a("<div/>"),this.container.append(k),a.extend(!0,this.scrollbar,{onScroll:this.shiftTo,end:this.maxItems,position:this.currentLayer,repeating:this.repeating}),this.scrollbar._instance=new h(k,this.scrollbar));for(n=0,o=f.length;o>n;n++)g=f[n],this._loadItem(a(g));this.showContainer&&this.container.show()}return b.rondellCount=0,b.activeRondell=null,b.prototype.update=function(b){return a.extend(!0,this,b||{}),this.shiftTo(this.currentLayer)},b.prototype.clear=function(){return this.container.data(_,this).removeClass(""+this.lassInitializing+" "+j+" "+Q+"-"+this.theme+" "+m+"-"+this.id).find("."+k).remove(),this.container.children("."+n).removeClass(n),this.container.rondell=null},b.prototype.equals=function(a,b){var c,d;for(c in a)if(d=a[c],b[c]!==d)return!1;for(c in b)if(d=b[c],a[c]!==d)return!1;return!0},b.prototype.funcLeft=function(a,b){return b.center.left-b.itemProperties.size.width/2+Math.sin(a)*b.radius.x},b.prototype.funcTop=function(a,b){return b.center.top-b.itemProperties.size.height/2+Math.cos(a)*b.radius.y},b.prototype.funcDiff=function(a,b){return Math.pow(Math.abs(a)/b.maxItems,.5)*Math.PI},b.prototype.funcOpacity=function(a,b){return b.visibleItems>1?Math.max(0,1-Math.pow(a/b.visibleItems,2)):1===b.visibleItems?1:0},b.prototype.funcSize=function(){return 1},b.prototype.fitToContainer=function(){var b,c,d,e,f;return f=this.container.parent(),c=f.innerWidth(),b=f.innerHeight(),this._dimensions.computed||(e=this.size.width,d=this.size.height,a.extend(!0,this._dimensions,{computed:!0,center:{left:this.center.left/e,top:this.center.top/d},radius:{x:this.radius.x/e,y:this.radius.y/d},controls:{margin:{x:this.controls.margin.x/e,y:this.controls.margin.y/d}},itemProperties:{size:{width:this.itemProperties.size.width/e,height:this.itemProperties.size.height/d},sizeFocused:{width:this.itemProperties.sizeFocused.width/e,height:this.itemProperties.sizeFocused.height/d}}})),a.extend(!0,this,{size:{width:c,height:b},center:{left:this._dimensions.center.left*c,top:this._dimensions.center.top*b},radius:{x:this._dimensions.radius.x*c,y:this._dimensions.radius.y*b},controls:{margin:{x:this._dimensions.controls.margin.x*c,y:this._dimensions.controls.margin.y*b}},itemProperties:{size:{width:this._dimensions.itemProperties.size.width*c,height:this._dimensions.itemProperties.size.height*b},sizeFocused:{width:this._dimensions.itemProperties.sizeFocused.width*c,height:this._dimensions.itemProperties.sizeFocused.height*b}}}),this.container.css(this.size),this.shiftTo(this.currentLayer)},b.prototype._onMouseEnterItem=function(a){return this._getItem(a).onMouseEnter()},b.prototype._onMouseLeaveItem=function(a){return this._getItem(a).onMouseLeave()},b.prototype._getItem=function(a){return this.items[a-1]},b.prototype._loadItem=function(a){var b;return b=this.items.length+1,this._itemIndices[b]=b,this.items.push(new g(b,a,this).init()),b===this.maxItems?this._start():void 0},b.prototype.onItemInit=function(a){var b;return b=this._getItem(a),a===this.currentLayer?b.prepareFadeIn():b.prepareFadeOut(),b.runAnimation(!0)},b.prototype._start=function(){var b;return this.currentLayer=this.randomStart?Math.round(Math.random()*(this.maxItems-1)):Math.max(0,Math.min(this.currentLayer||Math.round(this.maxItems/2),this.maxItems)),"auto"===this.visibleItems&&(this.visibleItems=Math.max(2,~~(this.maxItems/2))),b=this.controls,b.enabled&&(this.controls._shiftLeft=a('<a href="#/"/>').addClass(""+k+" "+O).html(this.strings.prev).click(this.shiftLeft).css({left:b.margin.x,top:b.margin.y,zIndex:this.zIndex+this.maxItems+2}),this.controls._shiftRight=a('<a href="#/"/>').addClass(""+k+" "+P).html(this.strings.next).click(this.shiftRight).css({right:b.margin.x,top:b.margin.y,zIndex:this.zIndex+this.maxItems+2}),this.container.append(this.controls._shiftLeft,this.controls._shiftRight)),this.bindEvents(),this.container.removeClass(l),"function"==typeof this.initCallback&&this.initCallback(this),null==this._focusedItem&&(this._focusedItem=this._getItem(this.currentLayer)),this.shiftTo(this.currentLayer)},b.prototype.bindEvents=function(){var b;return d.keydown(this.keyDown),e.blur(this.onWindowBlur).focus(this.onWindowFocus),d.focusout(this.onWindowBlur).focusin(this.onWindowFocus),this.mousewheel.enabled&&null!=a.fn.mousewheel&&this.container.bind("mousewheel."+_,this._onMousewheel),this._onMobile()?this.touch.enabled&&this.container.bind("touchstart."+_+" touchmove."+_+" touchend."+_,this._onTouch):this.container.bind("mouseenter."+_+" mouseleave."+_,this._hover),b=this,this.container.delegate("."+n,"click."+_,function(c){var d;if(d=a(this).data("item"),b._focusedItem.id===d.id){if(b.lightbox.enabled)return c.preventDefault(),b.showLightbox()}else if(c.preventDefault(),!d.hidden&&d.object.is(":visible"))return b.shiftTo(d.currentSlot)}).delegate("."+n,"mouseenter."+_+" mouseleave."+_,function(c){var d;return d=a(this).data("item"),"mouseenter"===c.type?b._onMouseEnterItem(d.id):b._onMouseLeaveItem(d.id)})},b.prototype._onMobile=function(){return"undefined"!=typeof Modernizr&&null!==Modernizr?Modernizr.touch:void 0},b.prototype._onMousewheel=function(a,b,c){var d,f,g,h;if(this.mousewheel.enabled&&this.isFocused()&&(d=(new Date).getTime(),!(d-this.mousewheel._lastShift<this.mousewheel.minTimeBetweenShifts)))return h=e.scrollTop(),g=h+e.height(),f=this.container.offset().top+this.container.outerHeight()/2,f>h&&g>f&&Math.abs(c)>this.mousewheel.threshold?(a.preventDefault(),0>c?this.shiftLeft():this.shiftRight(),this.mousewheel._lastShift=d):void 0},b.prototype._onTouch=function(a){var b,c;if(this.touch.enabled){switch(c=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],a.type){case"touchstart":this.touch._start={x:c.pageX,y:c.pageY};break;case"touchmove":this.touch.preventDefaults&&a.preventDefault(),this.touch._end={x:c.pageX,y:c.pageY};break;case"touchend":this.touch._start&&this.touch._end&&(b=this.touch._end.x-this.touch._start.x,Math.abs(b)>this.touch.threshold&&(b>0?this.shiftLeft():0>b&&this.shiftRight()),this.touch._start=this.touch._end=void 0)}return!0}},b.prototype._hover=function(a){var c;return c=this.autoRotation.paused,"mouseenter"===a.type?(b.activeRondell=this.id,this.hovering=!0,c||(this.autoRotation.paused=!0,this._focusedItem.showCaption())):(this.hovering=!1,c&&!this.autoRotation.once&&(this.autoRotation.paused=!1,this._autoShiftInit()),this.alwaysShowCaption||this._focusedItem.hideCaption()),this.controls.enabled?this._refreshControls():void 0},b.prototype.shiftTo=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(null==b&&(b=!1),null!=a){for(!b&&this.switchIndices&&a!==this.currentLayer&&this.getIndexInRange(a)===this._focusedItem.currentSlot&&(m=this.getRelativeItemPosition(a,!0),c=m[0],g=m[1],g>this.currentLayer?a++:a--),a=this.getIndexInRange(a),f=this._itemIndices[a],e=this._getItem(f),this.switchIndices&&(this._itemIndices[a]=this._focusedItem.id,this._itemIndices[this._focusedItem.currentSlot]=f,e.currentSlot=this._focusedItem.currentSlot,this._focusedItem.currentSlot=a),this._focusedItem=e,this.currentLayer=a,this._focusedItem.prepareFadeIn(),n=this.items,i=0,k=n.length;k>i;i++)d=n[i],d!==this._focusedItem&&d.prepareFadeOut();for(o=this.items,j=0,l=o.length;l>j;j++)d=o[j],d.runAnimation();return this._autoShiftInit(),this._refreshControls(),this.lightbox.enabled&&Y()&&this.showLightbox(),this.scrollbar.enabled&&(h=a,a===this._focusedItem.currentSlot&&(h=this._focusedItem.currentSlot+1),this.scrollbar._instance.setPosition(h,!1)),"function"==typeof this.onAfterShift?this.onAfterShift(a):void 0}},b.prototype.getRelativeItemPosition=function(a,b){var c,d;return null==b&&(b=this.wrapIndices),c=Math.abs(a-this.currentLayer),d=a,c>this.visibleItems&&c>this.maxItems/2&&this.repeating&&b&&(a>this.currentLayer?d-=this.maxItems:d+=this.maxItems,c=Math.abs(d-this.currentLayer)),[c,d]},b.prototype.getIndexInRange=function(a){return this.repeating?1>a?a+=this.maxItems:a>this.maxItems&&(a-=this.maxItems):1>a?a=1:a>this.maxItems&&(a=this.maxItems),a},b.prototype._refreshControls=function(){return this.controls.enabled?(this.controls._shiftLeft.stop().fadeTo(this.controls.fadeTime,(this.currentLayer>1||this.repeating)&&this.hovering?1:0),this.controls._shiftRight.stop().fadeTo(this.controls.fadeTime,(this.currentLayer<this.maxItems||this.repeating)&&this.hovering?1:0)):void 0},b.prototype.shiftLeft=function(a){return null!=a&&a.preventDefault(),this.shiftTo(this.currentLayer-1)},b.prototype.shiftRight=function(a){return null!=a&&a.preventDefault(),this.shiftTo(this.currentLayer+1)},b.prototype._autoShiftInit=function(){var a;return a=this.autoRotation,this.isActive()&&a.enabled&&a._timer<0?a._timer=window.setTimeout(this._autoShift,a.delay):void 0},b.prototype._autoShift=function(){return this.autoRotation._timer=-1,this.isActive()&&this.isFocused()&&!Y()&&!this.autoRotation.paused?this.autoRotation.direction?this.shiftRight():this.shiftLeft():this._autoShiftInit()},b.prototype.onWindowFocus=function(){return this._windowFocused=!0},b.prototype.onWindowBlur=function(){return this._windowFocused=!1},b.prototype.isActive=function(){return!0},b.prototype.isFocused=function(){return this._windowFocused&&b.activeRondell===this.id},b.prototype.keyDown=function(a){var b,c;if(this.isActive()&&this.isFocused()&&(c=(new Date).getTime(),!(this._lastKeyEvent>c-this.keyDelay)))switch(this.autoRotation._timer>=0&&(window.clearTimeout(this.autoRotation._timer),this.autoRotation._timer=-1),this._lastKeyEvent=c,b=a.which||a.keyCode){case 37:return this.shiftLeft(a);case 39:return this.shiftRight(a);case 27:return R()}},b.prototype.showLightbox=function(){var b,c,d=this;return b=X(),c=a("."+A,b),Y()||b.add(c).css("visibility","hidden"),c.stop().fadeTo(100,0,function(){var b,e,f,g,h,j,k,l,m;if(e=a("."+B,c).html(d._focusedItem.object.html()),a("."+E).text(""+d.currentLayer+" | "+d.maxItems),a("."+v,e).style="",d._focusedItem.isLink&&(j=d._focusedItem.object.attr("href"),h=d._focusedItem.object.attr("target"),a("."+i,e).append("<a href='"+j+"' target='"+h+"'>"+d.strings.more+"</a>").attr("style","")),f=a("."+t,e),f&&d._focusedItem.referencedImage){for(m=["style","width","height"],k=0,l=m.length;l>k;k++)b=m[k],f.removeAttr(b);f[0].src=d._focusedItem.referencedImage}return f&&!f[0].complete?(g=a('<img style="display:none"/>'),c.append(d.iconCopy),g.one("load",ab)[0].src=d._focusedItem.referencedImage):setTimeout(ab,0)})},b}(),W=function(){return a("."+m+"-"+f.activeRondell).data("rondell")},$=0,Z=function(){return clearTimeout($),Y()?$=setTimeout(ab,200):void 0},Y=function(){var b;return null!=(b=a.rondell.lightbox.instance)?b.is(":visible"):void 0},R=function(){return Y()?X().stop().fadeOut(150):void 0},X=function(){var b;return a.rondell.lightbox.instance||(b=a.rondell.lightbox.instance=a(a.rondell.lightbox.template).appendTo(a("body")),a("."+D+", ."+z,b).bind(T,R),a("."+F,b).bind(T,function(){return W().shiftLeft()}),a("."+C,b).bind(T,function(){return W().shiftRight()}),e.bind(V,Z),b.bind(U,function(a,b,c,d){return W()._onMousewheel(a,b,c,d)})),a.rondell.lightbox.instance},ab=function(){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s;return b=X(),c=a("."+A,b),r=e.innerWidth(),q=e.innerHeight(),s=20,d=W(),f=d._focusedItem,b.css("display","block"),g=a("img:first",c),g.length&&(f.lightboxImageWidth||(f.lightboxImageWidth=g[0].width,f.lightboxImageHeight=g[0].height,g.attr("width",f.lightboxImageWidth).attr("height",f.lightboxImageHeight)),j=f.lightboxImageWidth,i=f.lightboxImageHeight,h=j/i,l=r-2*s,k=q-2*s,j>l&&(j=l,i=j/h),i>k&&(i=k,j=i*h),g.css({width:j,height:i})),b.add(c).css("visibility","visible"),o=c.outerWidth(),m=c.outerHeight(),n={marginLeft:-o/2,top:Math.max((q-m)/2,20)},p=function(){return"function"==typeof d.onUpdateLightbox?d.onUpdateLightbox(f):void 0},c.css("opacity")<1?c.css(n).fadeTo(200,1,p):(n.opacity=1,c.animate(n,200,p)),b.stop().fadeTo(150,1)},g=function(){function b(a,b,c){this.id=a,this.object=b,this.rondell=c,this.runAnimation=__bind(this.runAnimation,this),this.onAnimationFinished=__bind(this.onAnimationFinished,this),this.prepareFadeOut=__bind(this.prepareFadeOut,this),this.prepareFadeIn=__bind(this.prepareFadeIn,this),this.hideCaption=__bind(this.hideCaption,this),this.showCaption=__bind(this.showCaption,this),this.onMouseLeave=__bind(this.onMouseLeave,this),this.onMouseEnter=__bind(this.onMouseEnter,this),this.finalize=__bind(this.finalize,this),this.onError=__bind(this.onError,this),this.onIconLoad=__bind(this.onIconLoad,this),this.refreshDimensions=__bind(this.refreshDimensions,this),this.init=__bind(this.init,this),this.currentSlot=this.id,this.focused=this.hidden=this.animating=!1,this.isNew=this.resizeable=!0,this.icon=this.iconCopy=this.referencedImage=null,this.croppedSize=this.rondell.itemProperties.size,this.sizeSmall=this.rondell.itemProperties.size,this.sizeFocused=this.rondell.itemProperties.sizeFocused,this.objectCSSTarget={},this.objectAnimationTarget={},this.lastObjectAnimationTarget={},this.iconAnimationTarget={},this.lastIconAnimationTarget={},this.animationSpeed=this.rondell.fadeTime,this.isLink=this.object.is("a")}return b.prototype.init=function(){var b,c,d,e,f,g,h;if(this.object.is("img")&&(this.object=this.object.wrap("<div/>").parent()),this.object.addClass(n).data("item",this).css({opacity:0,width:this.sizeSmall.width,height:this.sizeSmall.height,left:this.rondell.center.left-this.sizeFocused.width/2,top:this.rondell.center.top-this.sizeFocused.height/2}),this.isLink&&this.rondell.lightbox.displayReferencedImages)for(e=this.object.attr("href"),d=this._getFiletype(e),h=this.rondell.imageFiletypes,f=0,g=h.length;g>f;f++)if(b=h[f],d===b){this.referencedImage=e;break}return c=this.object.find("img:first"),c.length?(this.icon=c,this.resizeable=!c.hasClass(G),this.icon.addClass(t),this.object.addClass(u),c.width()>0||c[0].complete&&c[0].width>0?window.setTimeout(this.onIconLoad,10):(this.iconCopy=a('<img style="display:none"/>'),a("body").append(this.iconCopy),this.iconCopy.one("load",this.onIconLoad).one("error",this.onError).attr("src",c.attr("src")))):S(0,this.finalize),this},b.prototype._getFiletype=function(a){return a.substr(a.lastIndexOf(".")+1).toLowerCase()},b.prototype.refreshDimensions=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,p;return g=(null!=(k=this.iconCopy)?k.width():void 0)||(null!=(l=this.iconCopy)?l[0].width:void 0)||this.icon[0].width||this.icon.width(),f=(null!=(m=this.iconCopy)?m.height():void 0)||(null!=(n=this.iconCopy)?n[0].height:void 0)||this.icon[0].height||this.icon.height(),d=j=g,c=i=f,h=this.rondell.itemProperties.size,e=this.rondell.itemProperties.sizeFocused,b=h,null!=(p=this.iconCopy)&&p.remove(),g&&f?(this.resizeable?(this.icon.addClass(w),i*=h.width/j,j=h.width,i>h.height&&(j*=h.height/i,i=h.height),this.rondell.cropThumbnails&&(this.icon.parent().hasClass(w)||this.icon.wrap(a("<div>").addClass(o)),b={width:h.width,height:h.width/j*i},b.height<h.height&&(b={width:h.height/b.height*b.width,height:h.height}),j=h.width,i=h.height),c*=e.width/d,d=e.width,c>e.height&&(d*=e.height/c,c=e.height)):(j=h.width,i=h.height,d=e.width,c=e.height),this.croppedSize=b,this.iconWidth=g,this.iconHeight=f,this.sizeSmall={width:Math.round(j),height:Math.round(i)},this.sizeFocused={width:Math.round(d),height:Math.round(c)}):void 0},b.prototype.onIconLoad=function(){return this.refreshDimensions(),this.finalize()},b.prototype.onError=function(){var a,b;return a=this.rondell.strings.loadingError.replace("%s",this.icon.attr("src")),this.icon.remove(),null!=(b=this.iconCopy)&&b.remove(),this.object.removeClass(u).addClass(p).html("<p>"+a+"</p>")},b.prototype.finalize=function(){var b,c,d,e,f,g,h;return this.object.removeClass(u),this.rondell.captionsEnabled&&(c=null,c=this.rondell.cropThumbnails?null!=(e=this.icon)?e.closest("."+this.classItemCrop).siblings():void 0:null!=(f=this.icon)?f.siblings():void 0,(null!=c?c.length:void 0)||this.icon||!this.object.children().length||(c=this.object.children()),(null!=c?c.length:void 0)||(b=this.object.attr("title")||(null!=(g=this.icon)?g.attr("title"):void 0)||(null!=(h=this.icon)?h.attr("alt"):void 0),b&&(c=a("<p>"+b+"</p>"),this.object.append(c))),(null!=c?c.length:void 0)&&(d=c.wrapAll("<div/>").parent().addClass(i),this.icon&&(this.overlay=d.addClass(v)))),this.rondell.onItemInit(this.id)},b.prototype.onMouseEnter=function(){return this.animating||this.hidden||!this.object.is(":visible")?void 0:this.object.addClass(this.rondell.itemHoveredClass).stop(!0).animate({opacity:1},this.rondell.fadeTime,this.rondell.funcEase)},b.prototype.onMouseLeave=function(){return this.object.removeClass(s),this.animating||this.hidden?void 0:this.object.stop(!0).animate({opacity:this.objectAnimationTarget.opacity},this.rondell.fadeTime,this.rondell.funcEase)},b.prototype.showCaption=function(){return this.rondell.captionsEnabled&&null!=this.overlay?this.overlay.stop(!0).css({height:"auto",overflow:"auto"}).fadeTo(300,1):void 0},b.prototype.hideCaption=function(){var a;return this.rondell.captionsEnabled&&(null!=(a=this.overlay)?a.is(":visible"):void 0)?this.overlay.stop(!0).css({height:this.overlay.height(),overflow:"hidden"}).fadeTo(200,0):void 0},b.prototype.prepareFadeIn=function(){var a,b,c,d;return this.focused=!0,this.hidden=!1,d=this.sizeFocused.width,c=this.sizeFocused.height,this.lastObjectAnimationTarget=this.objectAnimationTarget,this.objectAnimationTarget={width:d,height:c,left:this.rondell.center.left-d/2,top:this.rondell.center.top-c/2,opacity:1},this.objectCSSTarget={zIndex:this.rondell.zIndex+this.rondell.maxItems,display:"block"},this.animationSpeed=this.rondell.fadeTime,this.icon&&(this.lastIconAnimationTarget=this.iconAnimationTarget,a=0,b=0,this.resizeable||(b=(this.rondell.itemProperties.sizeFocused.height-this.iconHeight)/2,a=(this.rondell.itemProperties.sizeFocused.width-this.iconWidth)/2,this.iconAnimationTarget.marginTop=b,this.iconAnimationTarget.marginLeft=a),this.rondell.cropThumbnails)?this.iconAnimationTarget={marginTop:b,marginLeft:a,width:d,height:c}:void 0},b.prototype.prepareFadeOut=function(){var b,c,d,e,f,g,h,i,j,k,l,m;return this.focused=!1,b=this.currentSlot,l=this.rondell.itemProperties,d=l.size,m=this.rondell.getRelativeItemPosition(b),g=m[0],h=m[1],f=this.rondell.funcDiff(h-this.rondell.currentLayer,this.rondell,b),h<this.rondell.currentLayer&&(f*=-1),k=this.rondell.funcSize(f,this.rondell),e=this.sizeSmall.width*k,c=this.sizeSmall.height*k,j=this.rondell.zIndex-g,this.animationSpeed=this.rondell.fadeTime+l.delay*g,i={width:e,height:c,left:this.rondell.funcLeft(f,this.rondell,b)+(d.width-e)/2,top:this.rondell.funcTop(f,this.rondell,b)+(d.height-c)/2,opacity:0},this.objectCSSTarget={zIndex:j,display:"block"},g<=this.rondell.visibleItems?(i.opacity=this.rondell.funcOpacity(f,this.rondell,b),this.hidden=!1,this.icon&&(this.lastIconAnimationTarget=this.iconAnimationTarget,this.rondell.cropThumbnails&&(this.iconAnimationTarget={marginTop:(d.height-this.croppedSize.height)/2,marginLeft:(d.width-this.croppedSize.width)/2,width:this.croppedSize.width,height:this.croppedSize.height}),this.resizeable||(this.iconAnimationTarget={marginTop:(d.height-this.iconHeight)/2,marginLeft:(d.width-this.iconWidth)/2}))):this.hidden&&a.extend(this.objectCSSTarget,i),this.lastObjectAnimationTarget=this.objectAnimationTarget,this.objectAnimationTarget=i},b.prototype.onAnimationFinished=function(){return this.animating=!1,this.focused?(this.object.addClass(q),this.rondell.hovering||this.rondell.alwaysShowCaption||this.rondell._onMobile()?this.showCaption():void 0):this.objectAnimationTarget.opacity<this.rondell.opacityMin?(this.hidden=!0,this.object.css("display","none")):(this.hidden=!1,this.object.css("display","block"))},b.prototype.runAnimation=function(a){if(null==a&&(a=!1),this.object.css(this.objectCSSTarget),!this.hidden){if(!a&&!this.iconAnimationTarget||!this.icon||!this.focused&&this.rondell.equals(this.iconAnimationTarget,this.lastIconAnimationTarget)||this.icon.stop(!0).animate(this.iconAnimationTarget,this.animationSpeed,this.rondell.funcEase),!a&&null==this.objectAnimationTarget||!this.focused&&this.rondell.equals(this.objectAnimationTarget,this.lastObjectAnimationTarget))return this.onAnimationFinished();if(this.animating=!0,this.object.stop(!0).animate(this.objectAnimationTarget,this.animationSpeed,this.rondell.funcEase,this.onAnimationFinished),!this.focused)return this.object.removeClass(q),this.hideCaption()}},b}(),h=function(){function b(b,c){this.scrollRight=__bind(this.scrollRight,this),this.scrollLeft=__bind(this.scrollLeft,this),this.onScrollbarClick=__bind(this.onScrollbarClick,this),this.onDragStart=__bind(this.onDragStart,this),this.onDrag=__bind(this.onDrag,this),this.setPosition=__bind(this.setPosition,this),this.scrollTo=__bind(this.scrollTo,this),this.updatePosition=__bind(this.updatePosition,this),this._initControls=__bind(this._initControls,this);var d;a.extend(!0,this,a.rondell.defaults.scrollbar,c),this.container=b.addClass(H),this._drag={_dragging:!1,_lastDragEvent:0},this.container.addClass(""+H+"-"+this.orientation).css(this.style),this._initControls(),d=this.scrollControl.outerWidth(),this._minX=this.padding+this.scrollLeftControl.outerWidth()+d/2,this._maxX=this.container.innerWidth()-this.padding-this.scrollRightControl.outerWidth()-d/2,this.setPosition(this.position,!1,!0)}return b.prototype._initControls=function(){var b;return b='<div><span class="'+L+'">&nbsp;</span></div>',this.scrollLeftControl=a(b).addClass(M).click(this.scrollLeft),this.scrollRightControl=a(b).addClass(N).click(this.scrollRight),this.scrollControl=a('<div class="'+J+'">&nbsp;</div>').css("left",this.container.innerWidth()/2).mousedown(this.onDragStart),this.scrollBackground=a('<div class="'+I+'"/>'),this.container.append(this.scrollBackground,this.scrollLeftControl,this.scrollRightControl,this.scrollControl),this.container.add(this.scrollBackground).click(this.onScrollbarClick)},b.prototype.updatePosition=function(a,b){return null==b&&(b=!0),!a||a===this.position||a<this.start||a>this.end?void 0:(this.position=a,b?"function"==typeof this.onScroll?this.onScroll(a,!0):void 0:void 0)},b.prototype.scrollTo=function(a,b,c){var d;return null==b&&(b=!0),null==c&&(c=!0),a<this._minX||a>this._maxX?void 0:(this.scrollControl.stop(!0).css("left",a),d=Math.round((a-this._minX)/(this._maxX-this._minX)*(this.end-this.start))+this.start,d!==this.position?this.updatePosition(d,c):void 0)},b.prototype.setPosition=function(a,b,c){var d;return null==b&&(b=!0),null==c&&(c=!1),this.repeating&&(a<this.start&&(a=this.end),a>this.end&&(a=this.start)),c||!(a<this.start||a>this.end||a===this.position)?(d=Math.round((a-this.start)/(this.end-this.start)*(this._maxX-this._minX))+this._minX,this.scrollTo(d,!0,b)):void 0},b.prototype.onDrag=function(b){var c,d;return b.preventDefault(),this._drag._dragging?"mouseup"===b.type?(this._drag._dragging=!1,this.scrollControl.removeClass(K),a(window).unbind("mousemove mouseup",this.onDrag)):(c=0,c="top"===(d=this.orientation)||"bottom"===d?b.pageX-this.container.offset().left:b.pageY-this.container.offset().top,c=Math.max(this._minX,Math.min(this._maxX,c)),this.scrollTo(c,!1)):void 0},b.prototype.onDragStart=function(b){return b.preventDefault(),this._drag._dragging=!0,this.scrollControl.addClass(K),a(window).bind("mousemove mouseup",this.onDrag)},b.prototype.onScrollbarClick=function(a){return this.scrollTo(a.pageX-this.container.offset().left)},b.prototype.scrollLeft=function(a){var b;return a.preventDefault(),b=this.position-this.stepSize,this.keepStepOrder&&this.stepSize>1&&(b>=this.start?b-=(b-this.start)%this.stepSize:this.repeating&&(b=this.start+Math.floor((this.end-this.start)/this.stepSize)*this.stepSize)),this.setPosition(b)},b.prototype.scrollRight=function(a){var b;return a.preventDefault(),b=this.position+this.stepSize,this.keepStepOrder&&this.stepSize>1&&(b-=(b-this.start)%this.stepSize,this.repeating&&b>this.end&&(b=this.start)),this.setPosition(b)},b}(),a.fn.rondell=function(b,c){var d;return null==b&&(b={}),null==c&&(c=void 0),d=a(this),this.length>1?this.each(function(){return d.rondell(b,c)}):void 0===d.data("rondell")?new f(this,b,c):d.data("rondell").update(b),this}}(jQuery,window,document),function(a){return a.rondell||(a.rondell={}),a.rondell.presets={carousel:{autoRotation:{enabled:!0,direction:1,once:!1,delay:5e3},radius:{x:240,y:50},center:{left:340,top:160},controls:{margin:{x:130,y:260}},randomStart:!0,currentLayer:1,funcSize:function(a){return 1/Math.abs(a)}},scroller:{repeating:!1,alwaysShowCaption:!0,visibleItems:4,theme:"dark",lightbox:{enabled:!1},itemProperties:{delay:0,size:{width:100,height:200},sizeFocused:{width:300,height:200}},center:{left:400,top:100},size:{width:800,height:200},controls:{margin:{x:210,y:158}},funcTop:function(){return 0},funcDiff:function(a){return Math.abs(a)+1},funcLeft:function(a,b){return b.center.left+(a-.5)*b.itemProperties.size.width},funcOpacity:function(){return.8}},pages:{radius:{x:0,y:0},lightbox:{enabled:!1},scaling:1,theme:"page",visibleItems:1,controls:{margin:{x:0,y:0}},strings:{prev:" ",next:" "},center:{left:200,top:200},itemProperties:{size:{width:400,height:400}},funcTop:function(a,b){return b.center.top-b.itemProperties.size.height/2},funcLeft:function(a,b){return b.center.left+a*b.itemProperties.size.width},funcDiff:function(a){return Math.abs(a)+.5}},cubic:{center:{left:300,top:200},visibleItems:5,itemProperties:{size:{width:350,height:350},sizeFocused:{width:350,height:350}},controls:{margin:{x:70,y:330}},funcTop:function(a,b){return b.center.top-b.itemProperties.size.height/2+Math.pow(a/2,3)*b.radius.x},funcLeft:function(a,b){return b.center.left-b.itemProperties.size.width/2+Math.sin(a)*b.radius.x},funcSize:function(a){return Math.pow((Math.PI-Math.abs(a))/Math.PI,3)}},gallery:{special:{itemPadding:2},visibleItems:5,theme:"dark",cropThumbnails:!0,center:{top:145,left:250},size:{height:400,width:500},controls:{margin:{x:10,y:255}},itemProperties:{delay:0,sizeFocused:{width:480,height:280},size:{width:80,height:100}},funcTop:function(a,b){return b.size.height-b.itemProperties.size.height-b.special.itemPadding},funcDiff:function(a){return Math.abs(a)-.5},funcLeft:function(a,b){return b.center.left+(a-.5)*(b.itemProperties.size.width+b.special.itemPadding)},funcOpacity:function(){return.8}},thumbGallery:{special:{columns:3,rows:3,groupSize:9,itemPadding:5,thumbsOffset:{x:500,y:0}},visibleItems:9,wrapIndices:!1,currentLayer:1,switchIndices:!0,cropThumbnails:!0,center:{top:215,left:250},size:{height:430,width:800},controls:{enabled:!1,margin:{x:10,y:255}},itemProperties:{delay:40,sizeFocused:{width:480,height:420},size:{width:94,height:126}},scrollbar:{enabled:!0,stepSize:9,start:2,style:{width:292,right:3,bottom:5}},funcDiff:function(a){return Math.abs(a)},funcOpacity:function(a,b,c){var d;return d=b.currentLayer>b._focusedItem.currentSlot?b.currentLayer-1:b.currentLayer,c>b._focusedItem.currentSlot&&c--,Math.floor((c-1)/b.special.groupSize)===Math.floor((d-1)/b.special.groupSize)?.8:0},funcTop:function(a,b,c){return c>b._focusedItem.currentSlot&&c--,b.special.thumbsOffset.y+b.special.itemPadding+Math.floor((c-1)%b.special.groupSize/b.special.rows)*(b.itemProperties.size.height+b.special.itemPadding)
},funcLeft:function(a,b,c){var d,e,f;return e=b.currentLayer>b._focusedItem.currentSlot?b.currentLayer-1:b.currentLayer,c>b._focusedItem.currentSlot&&c--,d=(c-1)%b.special.groupSize%b.special.columns,f=Math.floor((c-1)/b.special.groupSize)-Math.floor((e-1)/b.special.groupSize),b.special.thumbsOffset.x+b.special.itemPadding+(d+b.special.columns*f)*(b.itemProperties.size.width+b.special.itemPadding)}},slider:{theme:"slider",visibleItems:1,fadeTime:1e3,opacityMin:.01,autoRotation:{enabled:!0},center:{top:150,left:300},size:{height:300,width:600},controls:{margin:{x:-1,y:135}},strings:{prev:"<span>&nbsp;</span>",next:"<span>&nbsp;</span>"},itemProperties:{sizeFocused:{width:600,height:300},size:{width:600,height:300}},funcTop:function(){return 0},funcLeft:function(){return 0},funcOpacity:function(){return.02}}}}(jQuery);